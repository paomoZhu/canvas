function windowToCanavas(e,t){var n=canvas.getBoundingClientRect();return{x:e-n.left*(canvas.width/n.width),y:t-n.top*(canvas.height/n.height)}}function drawGrid(e,t,n,a){e.strokeStyle=t,e.lineWidth=1;for(o=n+1;o<e.canvas.width;o+=n)e.beginPath(),e.moveTo(o,0),e.lineTo(o,e.canvas.height),e.stroke();for(var o=a+1;o<e.canvas.height;o+=a)e.beginPath(),e.moveTo(0,o),e.lineTo(e.canvas.width,o),e.stroke()}function saveDrawingSurface(){drawingSurfaceImageData=context.getImageData(0,0,canvas.width,canvas.height)}function restoreDrawingSurface(){context.putImageData(drawingSurfaceImageData,0,0)}function updateRubberbandRectangle(e){rubberbandRect.width=Math.abs(e.x-mousedown.x),rubberbandRect.height=Math.abs(e.y-mousedown.y),e.x>mousedown.x?rubberbandRect.left=mousedown.x:rubberbandRect.left=e.x,e.y>mousedown.y&&(rubberbandRect.top=mousedown.y,rubberbandRect.top=e.y)}function drawRubberbandShape(e){context.beginPath(),context.moveTo(mousedown.x,mousedown.y),context.lineTo(e.x,e.y),context.stroke()}function updateRubberband(e){updateRubberbandRectangle(e),drawRubberbandShape(e)}function drawHorizontalLine(e){context.beginPath(),context.moveTo(0,e+.5),context.lineTo(context.canvas.width,e+.5),context.stroke()}function drawVerticalLine(e){context.beginPath(),context.moveTo(e+.5,0),context.lineTo(e+.5,context.canvas.height),context.stroke()}function drawGuidewires(e,t){context.save(),context.strokeStyle="rgba(0,0,230,0.4)",context.lineWidth=.5,drawHorizontalLine(t),drawVerticalLine(e),context.restore()}var eraseAllButton=document.getElementById("eraseAllButton"),strokeStyleSelect=document.getElementById("strokeStyleSelect"),guidewireCheckbox=document.getElementById("guidewireCheckbox"),drawingSurfaceImageData,mousedown={},rubberbandRect={},dragging=!1,guidewires=guidewireCheckbox.checked;canvas.onmousedown=function(e){var t=windowToCanavas(e.clientX,e.clientY);e.preventDefault(),saveDrawingSurface(),mousedown.x=t.x,mousedown.y=t.y,dragging=!0},canvas.onmousemove=function(e){var t;dragging&&(e.preventDefault(),t=windowToCanavas(e.clientX,e.clientY),restoreDrawingSurface(),updateRubberband(t),guidewires&&drawGuidewires(t.x,t.y))},canvas.onmouseup=function(e){loc=windowToCanavas(e.clientX,e.clientY),restoreDrawingSurface(),updateRubberband(loc),dragging=!1},eraseAllButton.onclick=function(e){context.clearRect(0,0,canvas.width,canvas.height),drawGrid(context,"lightgray",10,10),saveDrawingSurface()},strokeStyleSelect.onchange=function(e){context.strokeStyle=strokeStyleSelect.value},guidewireCheckbox.onchange=function(e){guidewires=guidewireCheckbox.checked},context.strokeStyle=strokeStyleSelect.value,drawGrid(context,"lightgray",10,10);