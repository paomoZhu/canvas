function word_cloud(t){var a=this;a.ownerDocument=document,a.ownerWindow=window,a.config=t,a.canvas=a.ownerDocument.getElementById("word_cloud_canvas"),a.canvas.width=a.config.width,a.canvas.height=a.config.height,a.ctx=a.canvas.getContext("2d"),a.canvas.style.zIndex=1,a.canvas_temp=a.ownerDocument.createElement("canvas"),a.canvas_temp.width=a.config.width,a.canvas_temp.height=a.config.height,a.ctx_temp=a.canvas_temp.getContext("2d"),a.canvas_temp.style.zIndex=0,a.word=[],a.canvas.style.backgroundColor=a.config.bgcolor}word_cloud.prototype.clear=function(){var t=this;t.ctx.clearRect(0,0,t.config.width,t.config.height),t.ctx_temp.clearRect(0,0,t.config.width,t.config.height),t.word=[],clearTimeout(t._timeout)},word_cloud.prototype.show=function(t,a){var e=this;e.clear(),t=t.sort(function(t,a){return parseInt(a[0])-parseInt(t[0])});for(m=0;m<t.length;m++)if(t[m]){var o=t[m],n=parseInt(o[0])*e.config.size_zoom,i=o[1],c=o[2];n<e.config.min_size&&(n=e.config.min_size),e.word.push({size:n,text:i,color:c})}for(var r=[],h=Math.floor(e.config.width/2),d=Math.floor(e.config.height/2),f=1,s=!0;s;){var g=h-f*e.config.minstep,l=h+f*e.config.minstep,_=d-f*e.config.minstep,p=d+f*e.config.minstep;s=!1;var u=[];if(_>=0){for(m=g;m<l;m+=e.config.minstep)u.push([m,_]),u.push([m,p]);s=!0}if(g>=0){for(var m=_;m<p;m+=e.config.minstep)u.push([l,m]),u.push([g,m]);s=!0}u=u.sort(function(){return Math.floor(1e3*Math.random())>500}),r=r.concat(u),f++}e.pixel=r;var M=0,x=function(){M<e.word.length?(e.appendWord(e.word[M]),M++,e._timeout=setTimeout(x,e.config.speed)):a&&a()};e._timeout=setTimeout(x,e.config.speed)},word_cloud.prototype.appendWord=function(t){var a=this,e=0;100*Math.random()<a.config.rotate_chance&&(e=Math.round(40*Math.random()),10*Math.random()>5&&(e=0-e));for(var o=a.ctx.getImageData(0,0,a.config.width,a.config.height),n=a.wordPixel(t.text,t.size,t.color,e),i=n.width,c=n.height,r=Math.round(i/2),h=0;h<a.pixel.length;h+=r){var d=Math.round(a.pixel[h][0]-i/2),f=Math.round(a.pixel[h][1]-c/2),s=0,g=0,l=!1;if(!(d<0||f<0||d+i>a.config.width||f+c>a.config.height)){for(;s<c+a.config.spacing;){var _=4*((f+s)*a.config.width+d+g),p=4*(s*i+g);if((o.data[_]>0||o.data[_+1]>0||o.data[_+2]>0||o.data[_+3]>0)&&(n.data[p]>0||n.data[p+1]>0||n.data[p+2]>0||n.data[p+3]>0)){l=!0;break}++g>=i&&(s++,g=0)}if(!l){var u=a.ctx.createImageData(i,c);for(s=0,g=0;s<c+a.config.spacing;){var _=4*((f+s)*a.config.width+d+g),p=4*(s*i+g);o.data[_]>0||o.data[_+1]>0||o.data[_+2]>0||o.data[_+3]>0?(u.data[p]=o.data[_],u.data[p+1]=o.data[_+1],u.data[p+2]=o.data[_+2],u.data[p+3]=o.data[_+3]):(u.data[p]=n.data[p],u.data[p+1]=n.data[p+1],u.data[p+2]=n.data[p+2],u.data[p+3]=n.data[p+3]),++g>=i&&(s++,g=0)}a.ctx.putImageData(u,d,f);break}}}a.ctx_temp.clearRect(0,0,a.config.width,a.config.height)},word_cloud.prototype.MeasureHeight=function(t,a,e,o){var n=t+":"+a+":"+e+":"+o;if("object"==typeof __measuretext_cache__&&__measuretext_cache__[n])return __measuretext_cache__[n][1];var i=document.createElement("DIV");i.innerHTML=t,i.style.position="absolute",i.style.top="-100px",i.style.left="-100px",i.style.fontFamily=e,i.style.fontWeight=a?"bold":"normal",i.style.fontSize=o+"px",document.body.appendChild(i);var o=[i.offsetWidth,i.offsetHeight];return document.body.removeChild(i),"object"!=typeof __measuretext_cache__&&(__measuretext_cache__=[]),__measuretext_cache__[n]=o,o[1]},word_cloud.prototype.wordPixel=function(t,a,e,o){var n=this;if(!e)if(n.config.default_color&&n.config.default_color.length>0){var i=Math.round(Math.random()*n.config.default_color.length);e=n.config.default_color[i]}else e="#"+Math.floor(255*Math.random()).toString(16)+Math.floor(255*Math.random()).toString(16)+Math.floor(255*Math.random()).toString(16);n.ctx_temp.textBaseline="top",n.ctx_temp.font=n.config.default_bold+" "+a+"px "+n.config.default_family,n.ctx_temp.fillStyle=e,n.ctx_temp.strokeStyle=e;var c=n.MeasureHeight(t,n.config.default_bold,n.config.default_family,a)+n.config.spacing,r=n.ctx_temp.measureText(t).width+n.config.spacing;if(isNaN(o)||0==o)n.ctx_temp.fillText(t,0,0);else{var h=o,a=function(t,a,e){var o,n;return t<0&&(t+=360),t>0&&t<=90&&(o=Math.cos(Math.PI/180*t)*a+Math.sin(Math.PI/180*t)*e,n=Math.cos(Math.PI/180*t)*e+Math.sin(Math.PI/180*t)*a),t>90&&t<180&&(t=180-t,o=Math.cos(Math.PI/180*t)*a+Math.sin(Math.PI/180*t)*e,n=Math.cos(Math.PI/180*t)*e+Math.sin(Math.PI/180*t)*a),t>=180&&t<270&&(t=270-t,o=Math.cos(Math.PI/180*t)*a+Math.sin(Math.PI/180*t)*e,n=Math.cos(Math.PI/180*t)*e+Math.sin(Math.PI/180*t)*a),t>270&&t<360&&(t=360-t,o=Math.cos(Math.PI/180*t)*a+Math.sin(Math.PI/180*t)*e,n=Math.cos(Math.PI/180*t)*e+Math.sin(Math.PI/180*t)*a),{width:o,height:n}}(o,r,c),d=Math.round(a.width),f=Math.round(a.height),s=Math.round(r/2),g=Math.round(c/2);n.ctx_temp.translate(s,g),n.ctx_temp.rotate(Math.PI/180*h),n.ctx_temp.fillText(t,(d/2-r/2>0?d/2-r/2:0)-s,(f/2-c/2>0?f/2-c/2:0)-g),n.ctx_temp.rotate(Math.PI/180*-h),n.ctx_temp.translate(-s,-g),r=d,c=f}return n.ctx_temp.getImageData(0,0,r,c)};