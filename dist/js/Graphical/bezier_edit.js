function windowToCanvas(t,n){var o=canvas.getBoundingClientRect();return{x:(t-o.left)*(canvas.width/o.width),y:(n-o.top)*(canvas.height/o.height)}}function saveDrawingSuiface(){drawingImageData=context.getImageData(0,0,canvas.width,canvas.height)}function restoreDrawingSuiface(){context.putImageData(drawingImageData,0,0)}function updateRubberbandRectangle(t){rubberbandRect.width=Math.abs(t.x-mousedown.x),rubberbandRect.height=Math.abs(t.y-mousedown.y),t.x>mousedown.x?rubberbandRect.left=mousedown.x:rubberbandRect.left=t.x,t.y>mousedown.y?rubberbandRect.top=mousedown.y:rubberbandRect.top=t.y}function drawBezierCurve(){context.beginPath(),context.moveTo(endPoints[0].x,endPoints[0].y),context.bezierCurveTo(controlPoints[0].x,controlPoints[0].y,controlPoints[1].x,controlPoints[1].y,endPoints[0].x,endPoints[0].y),context.stroke()}function updateEndAndControlPoints(){endPoints[0].x=rubberbandRect.left,endPoints[0].y=rubberbandRect.top,endPoints[1].x=rubberbandRect.left+rubberbandRect.width,endPoints[1].y=rubberbandRect.top+rubberbandRect.height,controlPoints[0].x=rubberbandRect.left,controlPoints[0].y=rubberbandRect.top+rubberbandRect.height,controlPoints[1].x=rubberbandRect.left+rubberbandRect.width,controlPoints[1].y=rubberbandRect.top}function drawRubberbandShape(t){updateEndAndControlPoints(),drawBezierCurve()}function drawControlPoint(t){context.beginPath(),context.arc(controlPoints[t].x,controlPoints[t].y,control_point_radius,o,2*Math.PI,!1),context.stroke(),context.fill()}function drawControlPoints(){context.save(),context.strokeStyle=control_point_stroke_style,context.fillStyle=control_point_fill_style,drawControlPoint(0),drawControlPoint(1),context.stroke(),context.fill(),context.restore()}function drawEndPoint(t){context.beginPath(),context.arc(endPoints[t].x,endPoints[t].y,control_point_radius,0,2*Math.PI,!1),context.stroke(),context.fill()}function drawEndPoints(){context.save(),context.strokeStyle=end_point_stroke_style,context.fillStyle=end_point_fill_style,drawEndPoint(0),drawEndPoint(1),context.stroke(),context.fill(),context.restore()}function drawControlAndEndPoints(){drawControlPoints(),drawEndPoints()}function cursorInEndPoint(t){var n;return endPoints.forEach(function(o){context.beginPath(),context.arc(o.x,o.y,control_point_radius,0,2*Math.PI,!1),context.isPointInPath(t.x,t.y)&&(n=o)}),n}function cursorInControlPoint(t){var n;return controlPoints.forEach(function(o){context.beginPath(),context.arc(o.x,o.y,control_point_radius,0,2*Math.PI,!1),context.isPointInPath(t.x,t.y)&&(n=o)}),n}function updateDraggingPoint(t){draggingPoint.x=t.x,draggingPoint.y=t.y}var eraseAllButton=query("eraseAllButton"),strokeStyleSelect=query("strokeStyleSelect"),guidewireCheckbox=query("guidewireCheckbox"),instructions=query("instructions"),instructionsOkayButton=query("instructionsOkayButton"),instructionsNoMoreButton=query("instructionsNoMoreButton"),showInstructions=!0,axis_margin=40,horizontal_tick_spacing=10,vertical_tick_spacing=10,tick_size=10,axis_orgin={x:axis_margin,y:canvas.height-axis_margin},axis_top=axis_margin,axis_right=canvas.width-axis_margin,axis_width=axis_right-axis_orgin.x,axis_height=axis_orgin.y-axis_top,num_vertical_ticks=axis_height/vertical_tick_spacing,num_horizaontal_ticks=axis_width/horizontal_tick_spacing,grid_stroke_style="lightblue",grid_spacing=10,control_point_radius=5,control_point_stroke_style="blue",control_point_fill_style="rgba(255, 255, 0, 0.5)",end_point_stroke_style="navy",end_point_fill_style="rgba(0, 255, 0, 0.5)",guidewire_stroke_style="rgba(0, 0, 230, 0.4)",drawingImageData,mousedown={},rubberbandRect={},dragging=!1,draggingPoint=!1,endPoints=[{},{}],controlPoints=[{},{}],editing=!1,guidewires=guidewireCheckbox.checked;canvas.onmousedown=function(t){var n=windowToCanvas(t.clientX,t.clientY);t.preventDefault(),editing?(draggingPoint=cursorInControlPoint(n))||(draggingPoint=cursorInEndPoint(n)):(saveDrawingSuiface(),mousedown.x=n.x,mousedown.y=n.y,updateRubberbandRectangle(n),dragging=!0)},canvas.onmouse=function(t){var n=windowToCanvas(t.clientX,t.clientY);(dragging||draggingPoint)&&(t.preventDefault(),restoreDrawingSuiface(),guidewires&&drawGuidewires(n.x,n.y)),dragging?(updateRubberband(n),drawControlAndEndPoints()):draggingPoint&&(updateDraggingPoint(n),drawControlAndEndPoints(),drawBezierCurve())},canvas.onmouseup=function(t){windowToCanvas(t.clientX,t.clientY);restoreDrawingSuiface(),editing?(draggingPoint?drawControlAndEndPoints():editing=!1,drawBezierCurve(),draggingPoint=void 0):(updateRubberband(),drawControlAndEndPoints(),dragging=!1,editing=!0,showInstructions&&(instructions.display="inline"))},eraseAllButton.onclick=function(t){context.clearRect(0,0,canvas.width,canvas.height),drawGrid(grid_stroke_style,grid_spacing,grid_spacing),saveDrawingSuiface(),editing=!1,dragging=!1,draggingPoint=void 0},strokeStyleSelect.onchange=function(t){context.strokeStyle=strokeStyleSelect.value},guidewireCheckbox.onchange=function(t){guidewires=guidewireCheckbox.checked},instructionsOkayButton.onclick=function(t){instructions.style.display="none"},instructionsNoMoreButton.onclick=function(t){instructions.style.display="none",showInstructions=!1},context.strokeStyle=strokeStyleSelect.value,drawGrid(grid_stroke_style,grid_spacing,grid_spacing);